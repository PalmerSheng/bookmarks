# Cloudflare Pages Functions è®¾ç½®æŒ‡å—

## ğŸš€ é—®é¢˜è§£å†³æ–¹æ¡ˆ

ä½ é‡åˆ°çš„ 405 é”™è¯¯æ˜¯å› ä¸º Cloudflare Pages é™æ€éƒ¨ç½²ç¯å¢ƒæ— æ³•å¤„ç† API ä»£ç†ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Cloudflare Pages Functionsã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

ç°åœ¨ä½ çš„é¡¹ç›®åº”è¯¥æœ‰ä»¥ä¸‹ç»“æ„ï¼š

```
project/
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ supabase/
â”‚           â””â”€â”€ functions/
â”‚               â””â”€â”€ v1/
â”‚                   â””â”€â”€ clever-action.js  # æ–°åˆ›å»ºçš„ä»£ç†å‡½æ•°
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ _headers                         # å·²æ›´æ–°
â”‚   â””â”€â”€ _redirects                       # å·²æ›´æ–°
â””â”€â”€ src/
    â””â”€â”€ stores/
        â””â”€â”€ reddit.js                    # æ— éœ€ä¿®æ”¹
```

## ğŸ”§ å·¥ä½œåŸç†

1. **å®¢æˆ·ç«¯è¯·æ±‚**: å‰ç«¯å‘é€è¯·æ±‚åˆ° `/api/supabase/functions/v1/clever-action`
2. **Pages Function**: Cloudflare Pages Function æ¥æ”¶è¯·æ±‚
3. **ä»£ç†è½¬å‘**: å‡½æ•°å°†è¯·æ±‚è½¬å‘åˆ°çœŸå®çš„ Supabase Edge Function
4. **å“åº”è¿”å›**: å°† Supabase çš„å“åº”è¿”å›ç»™å‰ç«¯

## ğŸ› ï¸ éƒ¨ç½²æ­¥éª¤

### 1. ç¡®è®¤æ–‡ä»¶å·²åˆ›å»º

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
- `functions/api/supabase/functions/v1/clever-action.js`
- `public/_redirects` (å·²æ›´æ–°)
- `public/_headers` (å·²å­˜åœ¨)

### 2. æäº¤ä»£ç 

```bash
git add .
git commit -m "Add Cloudflare Pages Functions for API proxy"
git push origin main
```

### 3. é‡æ–°éƒ¨ç½²

æ¨é€ä»£ç åï¼ŒCloudflare Pages ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚

### 4. éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œæ£€æŸ¥ï¼š
1. è®¿é—®ä½ çš„ç½‘ç«™
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
3. å°è¯•ä½¿ç”¨éœ€è¦è°ƒç”¨ API çš„åŠŸèƒ½
4. æ£€æŸ¥ Network æ ‡ç­¾é¡µï¼Œç¡®è®¤è¯·æ±‚æˆåŠŸ

## ğŸ” è°ƒè¯•

å¦‚æœä»ç„¶æœ‰é—®é¢˜ï¼Œå¯ä»¥ï¼š

### 1. æ£€æŸ¥ Cloudflare Pages æ—¥å¿—

åœ¨ Cloudflare Dashboard â†’ Pages â†’ ä½ çš„é¡¹ç›® â†’ Functions ä¸­æŸ¥çœ‹æ—¥å¿—ã€‚

### 2. æµ‹è¯• API ç«¯ç‚¹

ç›´æ¥è®¿é—®ï¼š`https://ä½ çš„åŸŸå.pages.dev/api/supabase/functions/v1/clever-action`

åº”è¯¥è¿”å› 405 é”™è¯¯ï¼ˆå› ä¸ºæ˜¯ GET è¯·æ±‚ï¼‰ï¼Œä½†ä¸åº”è¯¥æ˜¯ 404ã€‚

### 3. æ£€æŸ¥ç¯å¢ƒå˜é‡

ç¡®ä¿åœ¨ Cloudflare Pages è®¾ç½®ä¸­é…ç½®äº†ï¼š
- `VITE_SUPABASE_TOKEN`

## ğŸ’¡ å…³é”®æ”¹è¿›

1. **API ä»£ç†**: ä½¿ç”¨ Cloudflare Pages Functions å¤„ç† API ä»£ç†
2. **CORS å¤„ç†**: åœ¨ä»£ç†å‡½æ•°ä¸­æ­£ç¡®è®¾ç½® CORS å¤´éƒ¨
3. **é”™è¯¯å¤„ç†**: æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
4. **OPTIONS æ”¯æŒ**: æ”¯æŒé¢„æ£€è¯·æ±‚

## ğŸ¯ é¢„æœŸç»“æœ

éƒ¨ç½²åï¼Œä½ çš„åº”ç”¨åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… åœ¨ç”Ÿäº§ç¯å¢ƒæ­£å¸¸è°ƒç”¨ Supabase Edge Functions
- âœ… é¿å… CORS é”™è¯¯
- âœ… æ­£ç¡®å¤„ç† API è¯·æ±‚å’Œå“åº”
- âœ… ä¸å†å‡ºç° 405 é”™è¯¯

## ğŸ”„ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

1. æ£€æŸ¥ Cloudflare Pages æ„å»ºæ—¥å¿—
2. ç¡®è®¤ `functions` ç›®å½•è¢«æ­£ç¡®éƒ¨ç½²
3. éªŒè¯ç¯å¢ƒå˜é‡è®¾ç½®
4. æŸ¥çœ‹ Functions è¿è¡Œæ—¶æ—¥å¿—

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
2. æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾é¡µæˆªå›¾
3. Cloudflare Pages çš„æ„å»ºæ—¥å¿— 